<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Accessible AI-Powered URL Notifier Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
    <style>
        /* Highlight styles */
        
        .highlight-important-yellow {
            background-color: #b7d9e0; /* Light Blue */
            color: white;
            font-weight: bold;
            transition: background-color 0.5s ease;
        }
        .highlight-important-red {
            background-color: #ec4343; /* Strong red */
            color: white;
            font-weight: bold;
            transition: background-color 0.5s ease;
        }

        /* Alert styles */
        .alert-container {
            position: fixed;
            top: 20%;
            right: 20px;
            z-index: 1000;
            max-width: 300px;
        }
        .alert-item {
            background: linear-gradient(135deg, #f97316, #fb923c);
            color: white;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 5px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            animation: slideIn 0.3s ease;
            font-weight: bold;
        }
        .alert-item.red {
            background: #dc2626;
        }
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* Sidebar toggle animation */
        #sidebar {
            transition: transform 0.3s ease-in-out;
        
        }
        #sidebar.hidden {
            transform: translateX(-100%);
        }

        /* Bottom Navigation Bar Styles */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            /* Orange/Blue Mixed Gradient */
            background: linear-gradient(135deg, rgba(249, 115, 22, 0.9), rgba(81, 172, 208, 0.9));
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            padding: 12px 0;
            z-index: 100;
            display: flex;
            justify-content: space-around;
            border-top: 1px solid rgba(128, 124, 124, 0.2);
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: rgb(232, 226, 226);
            text-decoration: none;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            cursor: pointer;
            padding: 4px 8px;
            border-radius: 9px;
            position: relative; /* For the red alert badge */
        }
        .nav-item.active,
        .nav-item:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.05);
        }
        .nav-icon {
            width: 20px;
            height: 20px;
            margin-bottom: 2px;
            fill: none; /* Use stroke for clean line icons */
            stroke: currentColor;
            stroke-width: 2; /* Consistent stroke width */
            stroke-linecap: round;
            stroke-linejoin: round;
        }

        /* Red Alert Dot/Badge for Visualize Button */
        .nav-item .alert-dot {
            position: absolute;
            top: 0px; 
            right: 15px; 
            width: 8px;
            height: 8px;
            background-color: #dc2626; /* Red */
            border-radius: 50%;
            display: none; /* Initially hidden */
        }
        .nav-item.alert .alert-dot {
            display: block; /* Show when 'alert' class is present */
        }

        /* Adjust main content to account for bottom nav */
        main {
            padding-bottom: 80px; /* Add padding to avoid overlap with bottom nav */
        }
        /* Light theme adjustments - stronger, more comprehensive overrides so text remains readable */
        body.light-theme {
            background: linear-gradient(135deg, #fff3e0 0%, #e6f7ff 50%, #ffffff 100%) !important;
            color: #111; /* global text color for high contrast */
        }

        /* Header / sidebar backgrounds and text */
        body.light-theme header,
        body.light-theme #sidebar {
            background: linear-gradient(135deg, rgba(249, 115, 22, 0.08), rgba(135, 206, 235, 0.08)) !important;
            color: #111;
        }

        body.light-theme h1,
        body.light-theme h2,
        body.light-theme h3 {
            color: #0b1220; /* darker headings */
        }

        /* Ensure page content uses dark text on light theme */
        body.light-theme .page,
        body.light-theme main,
        body.light-theme .wrap,
        body.light-theme .brand {
            color: #0b1220;
        }

        /* Tables and headers */
        body.light-theme table {
            border-color: #caa07a;
        }

        body.light-theme table thead tr {
            background: linear-gradient(135deg, #fff8f0, #e6f7ff);
            color: #0b1220;
        }

        /* Inputs / selects should be readable */
        body.light-theme input,
        body.light-theme select,
        body.light-theme textarea {
            background: #ffffff;
            color: #0b1220;
            border-color: rgba(16,24,40,0.08);
        }

        /* Bottom nav and nav items */
        body.light-theme .bottom-nav {
            background: linear-gradient(135deg, rgba(249, 115, 22, 0.18), rgba(135, 206, 235, 0.18));
            color: #333;
        }

        body.light-theme .nav-item {
            color: #1f2937; /* dark gray for labels */
        }

        /* Ensure SVG icons (stroke) are visible in light theme */
        body.light-theme .nav-icon {
            stroke: #1f2937;
        }

        body.light-theme .nav-item.active,
        body.light-theme .nav-item:hover {
            color: #f97316;
            background: rgba(249, 115, 22, 0.06);
        }

        body.light-theme .sidebar-toggle svg {
            stroke: #1f2937;
        }

        /* History list items — readable background + dark text */
        body.light-theme #historyList li {
            background: linear-gradient(135deg, #e6f7ff, #fff3e0);
            color: #0b1220;
        }

        body.light-theme #historyList li button {
            background: #dc2626;
            color: rgb(1, 0, 0);
        }

        /* Alerts should remain legible */
        body.light-theme .alert-container {
            right: 20px; /* keep position */
        }
        body.light-theme .alert-item {
            color: #111;
            background: linear-gradient(135deg, #f97316, #fb923c);
        }

        /* General buttons in light theme */
        body.light-theme button {
            color: #fff; /* keep buttons readable when gradient background used */
        }

        /* Make sure any elements that were forced white default to dark */
        body.light-theme .text-white,
        body.light-theme .white-text {
            color: #0b1220 !important;
        }
        /* History list item styles */
        #historyList li {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: rgb(10, 5, 5);
            padding: 12px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        body.light-theme #historyList li {
            background: linear-gradient(135deg, #e6f7ff, #fff3e0);
            color: #333;
        }

        #historyList li button {
            background: #dc2626;
            color: rgb(5, 3, 3);
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: background-color 0.3s ease;
        }

        #historyList li button:hover {
            background: #b91c1c;
        }
    </style>
</head>
<body class="h-screen flex flex-col text-white" style="background: linear-gradient(135deg, #F97316 0%, #87CEEB 50%, #FFFFFF 100%);">
    <header class="p-4 flex justify-between items-center" style="background: linear-gradient(135deg, rgba(249, 115, 22, 0.85), rgba(135, 206, 235, 0.85));">
        <h1 style="color: rgb(6, 3, 3);" class="text-2xl font-bold">AI URL NOTIFIER</h1>

        <button id="sidebarToggle" onclick="toggleSidebar()" class="p-2 rounded bg-orange-600 hover:bg-orange-500 sidebar-toggle">
            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
            </svg>
        </button>
    </header>

    <div class="flex flex-1">
        <aside id="sidebar" class="w-64 p-4 space-y-4 hidden" style="background: linear-gradient(135deg, rgba(249, 115, 22, 0.85), rgba(135, 206, 235, 0.85));">
            <h2 class="text-lg font-semibold mb-2">Navigation</h2>
            <nav class="space-y-2">
                <button class="w-full px-3 py-2 rounded bg-orange-600 hover:bg-orange-500 text-left" onclick="showPage('analyze'); setActiveNav('analyze')">Analyze</button>
                <button class="w-full px-3 py-2 rounded bg-orange-600 hover:bg-orange-500 text-left" onclick="showPage('history'); setActiveNav('history'); loadHistory()">History</button>
                <button class="w-full px-3 py-2 rounded bg-orange-600 hover:bg-orange-500 text-left" onclick="navigateToVisualize()">Visualize</button>
                <button class="w-full px-3 py-2 rounded bg-orange-600 hover:bg-orange-500 text-left" onclick="showPage('settings'); setActiveNav('settings')">Settings</button>

            <button class="w-full px-3 py-2 rounded bg-orange-600 hover:bg-orange-500 text-left" onclick="window.location.href='index.html'">Log out</button>
            </nav>

            <h2 class="text-lg font-semibold mb-2 mt-4">Analysis Flow</h2>
            <svg class="w-full h-64 bg-sky-400 rounded p-2" viewBox="0 0 200 260" xmlns="http://www.w3.org/2000/svg">
                <rect id="importantUrlsRect" x="40" y="180" width="120" height="30" fill="#2563eb" />
                <text id="importantUrlsText" x="100" y="200" fill="white" text-anchor="middle" font-weight="bold" font-size="14">Important URLs</text>
                <line x1="100" y1="180" x2="100" y2="160" stroke="white" stroke-width="2" stroke-dasharray="4 2" />
                <line x1="100" y1="160" x2="100" y2="130" stroke="white" stroke-width="2" />
                <rect x="40" y="10" width="120" height="30" fill="#F97316" />
                <text x="100" y="30" fill="white" text-anchor="middle" font-weight="bold" font-size="14">Input URLs</text>
                <line x1="100" y1="40" x2="100" y2="70" stroke="white" stroke-width="2" />
                <rect x="40" y="70" width="120" height="30" fill="#3B82F6" />
                <text x="100" y="90" fill="white" text-anchor="middle" font-weight="bold" font-size="14">AI Analysis</text>
                <line x1="100" y1="100" x2="100" y2="130" stroke="white" stroke-width="2" />
                <rect x="40" y="130" width="120" height="30" fill="#F97316" />
                <text x="100" y="150" fill="white" text-anchor="middle" font-weight="bold" font-size="14">Notifier</text>
            </svg>
        </aside>

        <main class="flex-1 p-6 overflow-y-auto">
            <section id="analyze" class="page">
                <h2 class="text-xl font-bold mb-4">Analyze URLs</h2>
                <div class="flex space-x-2 mb-4">
                    <form class="flex space-x-2 flex-1" onsubmit="addUrl(event)">
                        <input id="urlInput" type="url" class="p-2 rounded w-1/3 text-black" placeholder="Enter a URL" required />
                        <input id="emailInput" type="email" class="p-2 rounded w-1/4 text-black" placeholder="Enter your email" required />
                        <select id="categoryInput" class="p-2 rounded w-1/6 text-black" required>
                            <option value="moderate">Moderate</option>
                            <option value="important">Important</option>
                        </select>
                        <button type="submit" class="bg-blue-600 px-4 py-2 rounded hover:bg-blue-500 w-1/6">Add</button>
                    </form>
                    <button class="bg-green-600 px-4 py-2 rounded hover:bg-green-500" onclick="refreshUrls()">Refresh</button>
                </div>

                <table class="w-full border-collapse border border-orange-400">
                    <thead>
                        <tr class="bg-orange-600">
                            <th class="p-2 border border-orange-400">URL</th>
                            <th class="p-2 border border-orange-400">Email</th>
                            <th class="p-2 border border-orange-400">Category</th>
                            <th class="p-2 border border-orange-400">Status</th>
                            <th class="p-2 border border-orange-400">Action</th>
                        </tr>
                    </thead>
                    <tbody id="urlTable"></tbody>
                </table>

                <div id="importantAlerts" class="mt-4 hidden">
                    <h3 class="text-lg font-bold mb-2">Important URL Alerts</h3>
                    <ul id="alertsList" class="space-y-2"></ul>
                </div>
            </section>

            <section id="history" class="page hidden">
                <h2 class="text-xl font-bold mb-4">History</h2>
                <div class="flex justify-between items-center mb-4">
                    <div></div> 
                    <div class="flex space-x-2">
                        <button class="bg-red-600 px-4 py-2 rounded hover:bg-red-500 text-white" onclick="clearHistory()">Clear History</button>
                        <button class="bg-purple-600 px-4 py-2 rounded hover:bg-purple-500 text-white" onclick="exportData()">Export Data</button>
                    </div>
                </div>
                <ul id="historyList" class="space-y-2"></ul>
            </section>

            <section id="settings" class="page hidden">
                <h2 class="text-xl font-bold mb-4">Settings</h2>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">Theme</label>
                        <button class="p-2 rounded bg-orange-700 hover:bg-orange-600 mr-2 text-white" onclick="setTheme('light')">Light Theme</button>
                        <button class="p-2 rounded bg-blue-700 hover:bg-blue-600 text-white" onclick="setTheme('dark')">Dark Theme</button>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <div id="alertContainer" class="alert-container hidden"></div>

    <nav class="bottom-nav">
        <div class="nav-item active" data-page="analyze" onclick="showPage('analyze'); setActiveNav('analyze')">
            <svg class="nav-icon" viewBox="0 0 24 24">
                <path d="M11 19a8 8 0 1 0 0-16 8 8 0 0 0 0 16z"></path>
                <path d="M21 21l-4.35-4.35"></path>
            </svg>
            Analyze
        </div>
        <div class="nav-item" data-page="history" onclick="showPage('history'); setActiveNav('history'); loadHistory()">
            <svg class="nav-icon" viewBox="0 0 24 24">
                <path d="M12 2v10l4 4"></path>
                <circle cx="12" cy="12" r="10"></circle>
            </svg>
            History
        </div>
        <div class="nav-item" data-page="visualize" id="visualizeNav" onclick="navigateToVisualize()">
            <span class="alert-dot"></span> 
            <svg class="nav-icon" viewBox="0 0 24 24">
                <rect x="3" y="12" width="6" height="8" rx="1"></rect>
                <rect x="9" y="8" width="6" height="12" rx="1"></rect>
                <rect x="15" y="4" width="6" height="16" rx="1"></rect>
            </svg>
            Visualize
        </div>
        <div class="nav-item" data-page="settings" onclick="showPage('settings'); setActiveNav('settings')">
            <svg class="nav-icon" viewBox="0 0 24 24">
                <circle cx="12" cy="12" r="3"></circle>
                <path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 01-2.83 2.83l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-4 0v-.09a1.65 1.65 0 00-1-1.51 1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83-2.83l.06-.06a1.65 1.65 0 00.33-1.82 1.65 1.65 0 00-1.51-1H3a2 2 0 010-4h.09a1.65 1.65 0 001.51-1 1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 012.83-2.83l.06.06a1.65 1.65 0 001.82.33H9a1.65 1.65 0 001-1.51V3a2 2 0 014 0v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 2.83l-.06.06a1.65 1.65 0 00-.33 1.82V9a1.65 1.65 0 001.51 1H21a2 2 0 010 4h-.09a1.65 1.65 0 00-1.51 1z"></path>
            </svg>
            Settings
        </div>
    </nav>

    <script>
        // Global URL data stored here
        let urls = [];

        // Show page by ID, hide others
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => {
                page.classList.toggle('hidden', page.id !== pageId);
            });
            // Sidebar toggle for mobile (optional)
            if (window.innerWidth <= 768) {
                hideSidebar();
            }
        }

        // Set active nav item
        function setActiveNav(pageId) {
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.toggle('active', item.dataset.page === pageId);
            });
        }

        // Toggle sidebar
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('hidden');
        }
        function hideSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.add('hidden');
        }

        // Add URL to list
        function addUrl(event) {
            event.preventDefault();
            const urlInput = document.getElementById('urlInput');
            const emailInput = document.getElementById('emailInput');
            const categoryInput = document.getElementById('categoryInput');
            
            const url = urlInput.value.trim();
            const email = emailInput.value.trim();
            const category = categoryInput.value;

            if (!url || !email) {
                alert('Please enter both URL and email');
                return;
            }
            if (!isValidUrl(url)) {
                alert('Please enter a valid URL');
                return;
            }
            if (!isValidEmail(email)) {
                alert('Please enter a valid email');
                return;
            }

            urls.push({
                url,
                email,
                category, 
                status: 'pending',
                timestamp: new Date().toISOString()
            });

            urlInput.value = '';
            emailInput.value = '';
            updateUrlTable();
            saveHistory();
            checkVisualizeAlert(); 
        }

        // Simple URL validation
        function isValidUrl(string) {
            try {
                new URL(string);
                return true;
            } catch (_) {
                return false;
            }
        }

        // Simple email validation
        function isValidEmail(email) {
            const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return re.test(email.toLowerCase());
        }

        // Update URL table display
        function updateUrlTable() {
            const tbody = document.getElementById('urlTable');
            tbody.innerHTML = '';
            urls.forEach((entry, idx) => {
                const tr = document.createElement('tr');
                // Highlight row if category is 'important'
                const rowClass = entry.category === 'important' ? 'bg-red-800' : (idx % 2 === 0 ? 'bg-blue-500' : 'bg-blue-700');
                tr.className = rowClass;
                tr.innerHTML = `
                    <td class="p-2 border border-orange-400 break-words">${entry.url}</td>
                    <td class="p-2 border border-orange-400 break-words">${entry.email}</td>
                    <td class="p-2 border border-orange-400 capitalize">${entry.category}</td>
                    <td class="p-2 border border-orange-400">${entry.status}</td>
                    <td class="p-2 border border-orange-400 text-center">
                        <button onclick="removeUrl(${idx})" class="bg-red-600 px-2 py-1 rounded hover:bg-red-500 text-white">Delete</button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
            checkImportantAlerts();
        }

        // Remove URL by index
        function removeUrl(index) {
            urls.splice(index, 1);
            updateUrlTable();
            saveHistory();
            checkVisualizeAlert(); 
        }

        // Refresh URLs — simulate status updates
        function refreshUrls() {
            urls = urls.map(entry => {
                if (entry.status === 'pending') {
                    return {...entry, status: Math.random() < 0.5 ? 'active' : 'inactive'};
                }
                return entry;
            });
            updateUrlTable();
            checkImportantAlerts();
            saveHistory();
        }

        // Check for important alerts (URLs that are 'important' category)
        function checkImportantAlerts() {
            const alertsDiv = document.getElementById('importantAlerts');
            const alertsList = document.getElementById('alertsList');
            alertsList.innerHTML = '';
            const importantUrls = urls.filter(u => u.category === 'important');

            if (importantUrls.length === 0) {
                alertsDiv.classList.add('hidden');
            } else {
                alertsDiv.classList.remove('hidden');

                importantUrls.forEach(u => {
                    const li = document.createElement('li');
                    li.textContent = `CRITICAL ALERT: Important URL is active: ${u.url}`;
                    li.className = 'highlight-important-yellow p-2 rounded';
                    alertsList.appendChild(li);
                });

                // Animate important URLs rectangle in SVG in sidebar
                const rect = document.getElementById('importantUrlsRect');
                if(rect) {
                    rect.classList.add('highlight-important-red');
                    setTimeout(() => {
                        rect.classList.remove('highlight-important-red');
                    }, 2000);
                }
            }
        }

        // Check if Visualize button needs a red alert
        function checkVisualizeAlert() {
            const visualizeNav = document.getElementById('visualizeNav');
            const hasImportant = urls.some(u => u.category === 'important');

            if (hasImportant) {
                visualizeNav.classList.add('alert');
            } else {
                visualizeNav.classList.remove('alert');
            }
        }


        // Load history from localStorage on History page
        function loadHistory() {
            const historyList = document.getElementById('historyList');
            const saved = localStorage.getItem('urlHistory');
            let history = [];
            if (saved) {
                try {
                    history = JSON.parse(saved);
                } catch (e) {
                    console.error('Failed to parse history data');
                }
            }
            historyList.innerHTML = '';
            if (history.length === 0) {
                historyList.innerHTML = '<li style="background:none; display:block; text-align:center; color:white;">No history yet.</li>';
                return;
            }
            history.forEach((entry, idx) => {
                const categoryText = entry.category ? ` (Cat: ${entry.category.charAt(0).toUpperCase() + entry.category.slice(1)})` : '';
                const li = document.createElement('li');
                li.innerHTML = `
                    <span class="break-words">${entry.url} (Email: ${entry.email})${categoryText}</span>
                    <button onclick="deleteHistoryItem(${idx})">Delete</button>
                `;
                historyList.appendChild(li);
            });
        }

        // Save current URLs to localStorage as history
        function saveHistory() {
            let saved = localStorage.getItem('urlHistory');
            let history = [];
            if (saved) {
                try {
                    history = JSON.parse(saved);
                } catch {}
            }
            urls.forEach(newEntry => {
                // Prevent duplicate entries in history based on url and email
                if (!history.some(h => h.url === newEntry.url && h.email === newEntry.email)) {
                    history.push(newEntry);
                }
            });
            localStorage.setItem('urlHistory', JSON.stringify(history));
        }

        // Clear all history
        function clearHistory() {
            if (!confirm('Are you sure you want to clear all history?')) return;
            localStorage.removeItem('urlHistory');
            loadHistory();
            showAlert('History cleared successfully!', 'orange');
        }

        // Delete single history item
        function deleteHistoryItem(index) {
            let saved = localStorage.getItem('urlHistory');
            if (!saved) return;
            let history = [];
            try {
                history = JSON.parse(saved);
            } catch {}
            history.splice(index, 1);
            localStorage.setItem('urlHistory', JSON.stringify(history));
            loadHistory();
            showAlert('History item deleted.', 'orange');
        }

    
    
    function exportData() {
        let saved = localStorage.getItem('urlHistory');
        let history = [];
        if (saved) {
            try {
                history = JSON.parse(saved);
            } catch {}
        }

        if (history.length === 0) {
            alert('No history data to export.');
            return;
        }

        // Define CSV headers
        const headers = ['URL', 'Email', 'Category', 'Status', 'Timestamp'];

        // Build CSV content
        const csvRows = [
            headers.join(',') // Header row
        ];

        history.forEach(entry => {
            const row = [
                "${entry.url}",
                "${entry.email}",
                "${entry.category || ''}",
                "${entry.status || ''}",
                "${entry.timestamp || ''}"
            ];
            csvRows.push(row.join(','));
        });

        const csvContent = csvRows.join('\n');

        // Create blob and trigger download
        const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
        const url = URL.createObjectURL(blob);
        const dlAnchorElem = document.createElement('a');
        dlAnchorElem.setAttribute("href", url);
        dlAnchorElem.setAttribute("download", "url_history.csv");
        document.body.appendChild(dlAnchorElem);
        dlAnchorElem.click();
        document.body.removeChild(dlAnchorElem);

        showAlert('History data is downloading as CSV.', 'orange');
    }


        // Navigate to Visualize with red alert notification
        function navigateToVisualize() {
            // Custom behavior: shows an alert and directs user to the analyze screen (as a visualization placeholder)
            showAlert('Job means red color lite', 'red');
            showPage('analyze'); 
            setActiveNav('visualize');
        }

        // Show alert notification
        function showAlert(message, type = 'orange') {
            const container = document.getElementById('alertContainer');
            container.classList.remove('hidden');

            const alert = document.createElement('div');
            alert.className = 'alert-item ' + (type === 'red' ? 'red' : '');
            alert.textContent = message;

            container.appendChild(alert);

            // Auto remove alert after 3 seconds
            setTimeout(() => {
                alert.style.opacity = '0';
                alert.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    container.removeChild(alert);
                    if(container.children.length === 0) {
                        container.classList.add('hidden');
                    }
                }, 500);
            }, 3000);
        }

        // Set light or dark theme
        function setTheme(theme) {
            if(theme === 'light') {
                document.body.classList.add('light-theme');
                document.body.style.background = 'linear-gradient(135deg, #fff3e0 0%, #e6f7ff 50%, #ffffff 100%)';
            } else {
                document.body.classList.remove('light-theme');
                document.body.style.background = 'linear-gradient(135deg, #F97316 0%, #87CEEB 50%, #FFFFFF 100%)';
            }
        }

        // Initialize app
        function init() {
            // Load initial URLs from history for persistence
            const saved = localStorage.getItem('urlHistory');
            if (saved) {
                try {
                    // Load the history into the live 'urls' array
                    urls = JSON.parse(saved); 
                } catch (e) {
                    console.error('Failed to parse saved URL data:', e);
                    urls = [];
                }
            }

            showPage('analyze');
            setActiveNav('analyze');
            updateUrlTable();
            loadHistory();
            checkVisualizeAlert(); // Initial check on load
        }

        window.onload = init;
    </script>
</body>
</html>

